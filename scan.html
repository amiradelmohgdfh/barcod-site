<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>اسکن بارکد</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="text-align:center;font-family:tahoma">

  <h2>اسکن بارکد</h2>
  <p>عکس بگیرید یا تصویر بارکد را انتخاب کنید</p>

  <input type="file" accept="image/*" capture="environment" id="fileInput">

  <p id="result" style="margin:15px;font-size:18px;"></p>

  <hr>
  <h3>بارکدهای ذخیره‌شده</h3>
  <ul id="list" style="list-style:none;padding:0;"></ul>

  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

  <script>
    const input = document.getElementById("fileInput");
    const result = document.getElementById("result");
    const list = document.getElementById("list");

    const html5QrCode = new Html5Qrcode("temp");

    function loadScans() {
      const scans = JSON.parse(localStorage.getItem("scans") || "[]");
      list.innerHTML = "";
      scans.forEach(item => {
        const li = document.createElement("li");
        li.innerText = item.code + " | " + item.time;
        list.appendChild(li);
      });
    }

    input.addEventListener("change", async () => {
      const file = input.files[0];
      if (!file) return;

      result.innerText = "در حال اسکن...";

      try {
        const code = await html5QrCode.scanFile(file, true);
        result.innerText = "بارکد اسکن شد: " + code;

        const scans = JSON.parse(localStorage.getItem("scans") || "[]");
        scans.unshift({
          code: code,
          time: new Date().toLocaleString("fa-IR")
        });
        localStorage.setItem("scans", JSON.stringify(scans));

        loadScans();
      } catch {
        result.innerText = "❌ بارکد شناسایی نشد";
      }
    });

    loadScans();
  </script>

</body>
</html>
