<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯ Ø§Ø² Ø±ÙˆÛŒ Ø¹Ú©Ø³ -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      text-align: center;
      padding: 25px;
    }
    button {
      font-size: 18px;
      padding: 12px 20px;
      cursor: pointer;
    }
    input {
      display: none;
    }
    ul {
      margin-top: 20px;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
      text-align: right;
    }
    li {
      margin-bottom: 8px;
    }
  </style>
</head>

<body>

<h2>Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯</h2>
<p>Ø¯Ú©Ù…Ù‡ Ø±Ø§ Ø¨Ø²Ù†ØŒ Ø¹Ú©Ø³ Ø¨Ú¯ÛŒØ±ØŒ Ø¨Ø§Ø±Ú©Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>

<button onclick="openCamera()">ğŸ“· Ú¯Ø±ÙØªÙ† Ø¹Ú©Ø³</button>

<input
  type="file"
  id="cameraInput"
  accept="image/*"
  capture="environment"
/>

<h3>Ù„ÛŒØ³Øª Ø¨Ø§Ø±Ú©Ø¯Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù†â€ŒØ´Ø¯Ù‡</h3>
<ul id="list"></ul>

<!-- div Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† -->
<div id="scanner" style="display:none;"></div>

<script>
  const input = document.getElementById("cameraInput");
  const list = document.getElementById("list");

  let saved = JSON.parse(localStorage.getItem("barcodes")) || [];

  function show() {
    list.innerHTML = "";
    saved.forEach((item, i) => {
      const li = document.createElement("li");
      li.textContent = (i + 1) + " - " + item.code + " â± " + item.time;
      list.appendChild(li);
    });
  }

  function openCamera() {
    input.click();
  }

  input.addEventListener("change", async () => {
    if (!input.files[0]) return;

    const file = input.files[0];
    const qr = new Html5Qrcode("scanner");

    try {
      const decodedText = await qr.scanFile(file, true);

      // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø«Ø¨Øª ØªÚ©Ø±Ø§Ø±ÛŒ
      if (saved.some(b => b.code === decodedText)) {
        alert("Ø§ÛŒÙ† Ø¨Ø§Ø±Ú©Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡");
        return;
      }

      const record = {
        code: decodedText,
        time: new Date().toLocaleString()
      };

      saved.push(record);
      localStorage.setItem("barcodes", JSON.stringify(saved));
      show();

      alert("âœ… Ø¨Ø§Ø±Ú©Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯");

    } catch (e) {
      alert("âŒ Ø¨Ø§Ø±Ú©Ø¯ÛŒ Ø¯Ø± ØªØµÙˆÛŒØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯");
    }
  });

  show();
</script>

</body>
</html>
